# Source the mailboxes from offlineimap.
source ~/.mutt/mailboxes

# Source the SMTP information.
source ~/.mutt/smtp

# Send with UTF-8.
set send_charset="UTF-8"

# By convention, we use INBOX; these are Gmail folders.
set spoolfile = "=INBOX"
set trash = "=Trash"
set postponed = "=Drafts"

# Leave read messages in the inbox.
unset mbox

# Don't ask whether to purge messages, just purge them.
set delete = yes

# Don't ask whether to append messages, just append them.
unset confirmappend

# See <http://blog.tshirtman.fr/tags/nottoomuch>; use notmuch as an
# address book.
set query_command="nottoomuch-addresses.sh %s"
bind editor <Tab> complete-query

# Sort threads by received descending.
set sort=threads
set sort_aux=reverse-last-date-received

# Compose with Emacs.
send-hook ~A 'set editor=emacs-wait'

# Search with notmuch.
macro browser <F8> "<enter-command>unset wait_key<enter><shell-escape>mutt-notmuch --prompt search<enter><change-dir>../.cache/<enter><search>mutt_results<enter><enter><enter-command>set wait_key<enter>" "search mail (using notmuch)"

## Miscellaneous navigation macros, etc.

# Sync everything
macro index O "<sync-mailbox><shell-escape>offlineimap<enter>"

# Just sync the inbox.
macro index o "<sync-mailbox><shell-escape>offlineimap -qf INBOX<enter>"

# Save messages.
macro index,pager i "<tag-thread><tag-prefix><save-message>=Saved<enter>" "Save thread"
macro index,pager I "<save-message>=Saved<enter>" "Save"

# Delete messages.
macro index,pager d "<tag-thread><tag-prefix><save-message>=Trash<enter>" "Trash thread"
macro index,pager D "<save-message>=Trash<enter>" "Trash message"
macro index \cd "<tag-pattern>~s.*<enter><tag-prefix><save-message>=Trash<enter>" "Trash all"

# Snooze messages.
macro index,pager 1 "<tag-thread><tag-prefix><save-message>=Snooze-1<enter>" "Snooze 1 day"
macro index,pager 7 "<tag-thread><tag-prefix><save-message>=Snooze-7<enter>" "Snooze 7 days"

# Change folders.
macro index ga "<change-folder>=Saved<enter>" "Go to saved messages"
macro index gd "<change-folder>=Drafts<enter>" "Go to drafts"
macro index gg "<change-folder>=Groups<enter>" "Go to saved messages"
macro index gi "<change-folder>=INBOX<enter>" "Go to inbox"
macro index gt "<change-folder>=Sent Mail<enter>" "Go to sent messages"
macro index gr "<change-folder>=Trash<enter>" "Go to sent messages"

# Thanks, Mike Swieton:
# <http://spin.atomicobject.com/2014/02/11/connect-mutt-gmail/>.
macro index,pager V "<enter-command>unset wait_key<enter><pipe-message>~/bin/mutt-gmail<enter><enter-command>set wait_key<enter>" "Open in Gmail"
