#!/usr/bin/env bash

# A wrapper for opencode-ai that allows profile selection.
# Usage: opencode [--profile work] [-- opencode arguments]

# ============================================
#  Flags
# ============================================
. "${HOME}/lib/shflags/shflags"

DEFINE_string 'profile' '' 'Profile to use (work)' 'p'

# ============================================
#  Main Logic
# ============================================
main() {
  local profile="${FLAGS_profile}"
  local other_args=("$@")

  # Set config file based on profile
  if [ "$profile" = "work" ]; then
      export OPENCODE_CONFIG="${HOME}/.config/opencode/opencode-work.json"
  fi

  # Execute opencode with remaining arguments
  exec npx -y opencode-ai@latest "${other_args[@]}"
}

# ============================================
#  Script Entry Point
# ============================================
FLAGS "$@" || exit $?
eval set -- "${FLAGS_ARGV}"

main "$@"
